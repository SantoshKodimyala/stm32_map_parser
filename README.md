# STM32 Map File Parser

A lightweight, dependency-free Python utility for parsing STM32CubeIDE generated map files and extracting symbol information. This tool is designed for firmware engineers who need to analyze memory usage, symbol locations, and project structure from linker map files.

## Features

- **Symbol Table Generation**: Create tab-separated files containing all symbols and their memory addresses
- **Symbol Address Lookup**: Get the memory address of any specific symbol
- **Symbol Categorization**: Count and categorize symbols into functions, global variables, and local variables
- **Pure Python**: No external dependencies required
- **Robust Error Handling**: Comprehensive exception handling for file operations and parsing errors
- **Cross-Platform**: Works on Windows, Linux, and macOS

## Installation

No installation required! This is a standalone Python script. Simply download the `stm32_map_parser.py` file and run it with Python 3.6+.

## Usage

### Basic Syntax

```bash
python stm32_map_parser.py -f <map_file> [options]
```

### Command Line Options

| Option | Description |
|--------|-------------|
| `-f, --file` | Path to the STM32CubeIDE map file (required) |
| `-t, --table` | Generate tab-separated symbol table file |
| `-s, --symbol` | Get memory address of specific symbol(s) |
| `-c, --count` | Display count of functions, global and local variables |
| `-h, --help` | Show help message and exit |

### Examples

#### 1. Generate Symbol Table
Create a tab-separated file with all symbols and their addresses:

```bash
python stm32_map_parser.py -f firmware.map -t symbols.txt
```

#### 2. Look Up Specific Symbol Addresses
Get the memory address of one or more symbols:

```bash
python stm32_map_parser.py -f firmware.map -s main -s SystemInit -s HAL_GPIO_Init
```

#### 3. Get Symbol Counts
Display counts of different symbol types:

```bash
python stm32_map_parser.py -f firmware.map -c
```

Output:
```
Symbol Counts:
Functions: 245
Global Variables: 67
Local Variables: 23
Total Symbols: 1420
```

#### 4. Combined Operations
You can combine multiple operations in a single command:

```bash
python stm32_map_parser.py -f firmware.map -t symbols.txt -c -s main -s SystemInit
```

## Output Formats

### Symbol Table File
The generated symbol table is a tab-separated file with the following format:

```
Symbol	Address
__stack	0x20020000
__heap_start	0x2001F800
main	0x08000A34
SystemInit	0x08000B12
HAL_GPIO_Init	0x08000C45
```

### Symbol Address Lookup
```
Symbol Address Lookup:
main: 0x08000A34
SystemInit: 0x08000B12
HAL_GPIO_Init: 0x08000C45
unknown_symbol: Not found
```

## Map File Compatibility

This parser is designed to work with map files generated by:
- STM32CubeIDE
- ARM GCC toolchain
- Other GCC-based toolchains for ARM Cortex-M

The parser handles various map file formats and sections including:
- Symbol tables
- Memory sections (.text, .data, .bss, .rodata)
- Linker-generated symbols
- Function and variable symbols

## Symbol Categorization

The parser categorizes symbols into three main types:

### Functions
- Symbols found in `.text` sections
- Symbols with function-like patterns
- Executable code symbols

### Global Variables
- Symbols in `.data`, `.bss`, or `.rodata` sections
- Variables with global scope
- Initialized and uninitialized data

### Local Variables
- File-specific symbols
- Variables with limited scope
- Static local variables

## Error Handling

The utility includes comprehensive error handling for:
- Missing map files
- File read/write permissions
- Malformed map file content
- Invalid symbol names
- Memory allocation issues

## Technical Details

### Requirements
- Python 3.6 or higher
- No external dependencies

### Performance
- Typical parsing time: <1 second for map files up to 10MB
- Memory usage: Minimal (proportional to number of symbols)
- Supports map files with 10,000+ symbols

### File Encoding
- Supports UTF-8 encoding
- Handles files with encoding errors gracefully
- Works with Windows, Linux, and macOS line endings

## Troubleshooting

### Common Issues

1. **"Map file not found" error**
   - Verify the file path is correct
   - Check file permissions
   - Ensure the file exists and is readable

2. **"No symbols found" or low symbol count**
   - Verify the map file is complete and not truncated
   - Check that the map file was generated with symbols enabled
   - Ensure the file is from STM32CubeIDE or compatible toolchain

3. **Symbol not found in lookup**
   - Symbol names are case-sensitive
   - Check for typos in symbol names
   - Verify the symbol exists in the map file

### Debug Tips

1. **Check map file format**: Open the map file in a text editor to verify its structure
2. **Verbose output**: Use multiple operations to see what symbols are being parsed
3. **Generate symbol table**: Create a full symbol table to see all parsed symbols

## Contributing

This utility is designed to be lightweight and dependency-free. When contributing:
- Maintain compatibility with Python 3.6+
- Keep the code dependency-free
- Add appropriate error handling
- Include comments for complex parsing logic
- Test with various map file formats

## License

MIT License

Copyright (c) [2025] [Santosh Kodimyala]

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

## Version History

- **v1.0**: Initial release with basic symbol parsing and lookup functionality
- Support for tab-separated symbol tables
- Symbol categorization (functions, global/local variables)
- Comprehensive error handling and cross-platform compatibility
